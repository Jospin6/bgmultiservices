(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[298],{97409:(e,s,a)=>{Promise.resolve().then(a.bind(a,17683))},17683:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>c});var r=a(95155),l=a(12115),t=a(83391),d=a(81654);let i=(0,a(14057).A)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);var o=a(48173),n=a.n(o),u=a(66658);function c(){let e=(0,t.wA)(),s=(0,t.d4)(e=>e.auth.users),a=(0,t.d4)(e=>e.auth.user);(0,u.useRouter)();let[o,c]=(0,l.useState)({name:"",password:"",role:""});(0,l.useEffect)(()=>{e((0,d.hU)()),e((0,d.Ny)())},[e]);let m=s=>{e((0,d.hG)(s))};return(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Gestion des utilisateurs"}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("span",{className:"block",children:["nom: ",null==a?void 0:a.name]}),(0,r.jsxs)("span",{className:"block",children:["role: ",null==a?void 0:a.role]})]}),(null==a?void 0:a.role)==="admin"&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:"text-[20px] font-bold mb-2",children:"Ajouter un nouveau utilisateur"}),(0,r.jsxs)("form",{onSubmit:s=>{s.preventDefault(),e((0,d.kg)(o)),c({name:"",password:"",role:""})},className:"mb-6 space-y-2",children:[(0,r.jsx)("input",{type:"text",placeholder:"Nom",value:o.name,onChange:e=>c({...o,name:e.target.value}),className:"border p-2 rounded w-full",required:!0}),(0,r.jsx)("input",{type:"password",placeholder:"Mot de passe",value:o.password,onChange:e=>c({...o,password:e.target.value}),className:"border p-2 rounded w-full",required:!0}),(0,r.jsxs)("select",{value:o.role,onChange:e=>c({...o,role:e.target.value}),className:"border p-2 rounded w-full",children:[(0,r.jsx)("option",{children:"Choix du r\xf4le"}),(0,r.jsx)("option",{value:"caissier",children:"Caissier"}),(0,r.jsx)("option",{value:"impression",children:"Impression"}),(0,r.jsx)("option",{value:"admin",children:"Admin"})]}),(0,r.jsx)("button",{type:"submit",className:"bg-blue-500 text-white p-2 rounded w-full",children:"Cr\xe9er un utilisateur"})]}),(0,r.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-200",children:[(0,r.jsx)("th",{className:"border p-2",children:"Nom"}),(0,r.jsx)("th",{className:"border p-2",children:"R\xf4le"}),(0,r.jsx)("th",{className:"border p-2",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:s.map(e=>(0,r.jsxs)("tr",{className:"text-center",children:[(0,r.jsx)("td",{className:"border p-2",children:e.name}),(0,r.jsx)("td",{className:"border p-2",children:e.role}),(0,r.jsx)("td",{className:"border p-2",children:(0,r.jsx)("button",{onClick:()=>m(e.id),className:"bg-red-500 text-white px-3 py-1 rounded",children:"Supprimer"})})]},e.id))})]})]}),(0,r.jsx)("div",{children:(null==a?void 0:a.role)!=""?(0,r.jsxs)(n(),{href:"/connexion",onClick:()=>e((0,d.ri)()),className:"flex text-red-500 mt-4",children:[(0,r.jsx)(i,{}),(0,r.jsx)("span",{children:"Deconnexion"})]}):(0,r.jsxs)(n(),{href:"/connexion",className:"flex text-red-500 mt-4",children:[(0,r.jsx)(i,{}),(0,r.jsx)("span",{children:"Connexion"})]})})]})}},81654:(e,s,a)=>{"use strict";a.d(s,{Ay:()=>b,Lx:()=>d,Ny:()=>p,hG:()=>c,hU:()=>o,kg:()=>i,ri:()=>h});var r=a(48943),l=a(75033),t=a(27058);let d=(0,r.zD)("auth/loginUser",async e=>{let{name:s,password:a}=e,r=(0,t.rJ)(l.db,"users"),d=(0,t.P)(r,(0,t._M)("name","==",s),(0,t._M)("password","==",a)),i=await (0,t.GG)(d);if(!i.empty){let e=i.docs[0].id,s=(0,t.H9)(l.db,"users",e),a=await (0,t.x7)(s),r=a.data();if(r)return localStorage.setItem("id",a.id),localStorage.setItem("name",r.name),localStorage.setItem("role",r.role),{name:r.name,id:a.id,role:r.role}}throw Error("Identifiants incorrects")}),i=(0,r.zD)("auth/createUser",async e=>{let s=(0,t.rJ)(l.db,"users"),a=await (0,t.gS)(s,e);return{...e,id:a.id}}),o=(0,r.zD)("auth/fetchUsers",async()=>{let e=(0,t.rJ)(l.db,"users");return(await (0,t.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}),n=(0,r.zD)("auth/fetchUserById",async e=>{let s=(0,t.H9)(l.db,"users",e),a=await (0,t.x7)(s);if(a.exists())return{id:a.id,...a.data()};throw Error("Utilisateur non trouv\xe9")}),u=(0,r.zD)("auth/updateUser",async e=>{if(!e.id)throw Error("User ID is required");let s=(0,t.H9)(l.db,"users",e.id),{id:a,...r}=e;return await (0,t.mZ)(s,r),e}),c=(0,r.zD)("auth/deleteUser",async e=>{let s=(0,t.H9)(l.db,"users",e);return await (0,t.kd)(s),e}),m=(0,r.Z0)({name:"auth",initialState:{user:null,users:[]},reducers:{logout:e=>{e.user=null,localStorage.removeItem("id"),localStorage.removeItem("name"),localStorage.removeItem("role")},currentUser:e=>{e.user={id:localStorage.getItem("id")||"",name:localStorage.getItem("name")||"",role:localStorage.getItem("role")||""}},checkUser:e=>{let s=localStorage.getItem("id"),a=localStorage.getItem("name"),r=localStorage.getItem("role");s&&a&&r?e.user={id:s,name:a,role:r}:e.user=null}},extraReducers:e=>{e.addCase(d.fulfilled,(e,s)=>{e.user=s.payload}).addCase(o.fulfilled,(e,s)=>{e.users=s.payload}).addCase(n.fulfilled,(e,s)=>{e.users.find(e=>e.id===s.payload.id)||e.users.push(s.payload)}).addCase(i.fulfilled,(e,s)=>{e.users.push(s.payload)}).addCase(u.fulfilled,(e,s)=>{let a=e.users.findIndex(e=>e.id===s.payload.id);-1!==a&&(e.users[a]=s.payload)}).addCase(c.fulfilled,(e,s)=>{e.users=e.users.filter(e=>e.id!==s.payload)})}}),{logout:h,currentUser:p,checkUser:x}=m.actions,b=m.reducer},75033:(e,s,a)=>{"use strict";a.d(s,{db:()=>d});var r=a(49904),l=a(27058);let t=(0,r.Wp)({apiKey:"AIzaSyASZSWBGwPJYuQDRi1GObaNtrccuaBfu70",authDomain:"bgmultiservices-781c8.firebaseapp.com",projectId:"bgmultiservices-781c8",messagingSenderId:"749311417727",appId:"1:749311417727:web:3ea8698ba8ac3ac7ac8e4a"}),d=(0,l.aU)(t)}},e=>{var s=s=>e(e.s=s);e.O(0,[992,876,125,441,517,358],()=>s(97409)),_N_E=e.O()}]);