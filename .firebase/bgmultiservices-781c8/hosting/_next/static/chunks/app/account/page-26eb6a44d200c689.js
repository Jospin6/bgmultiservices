(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[298],{97409:(e,a,s)=>{Promise.resolve().then(s.bind(s,17683))},17683:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>c});var r=s(95155),l=s(12115),t=s(83391),d=s(81654);let i=(0,s(14057).A)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);var o=s(48173),n=s.n(o),u=s(66658);function c(){let e=(0,t.wA)(),a=(0,t.d4)(e=>e.auth.users),s=(0,t.d4)(e=>e.auth.user);(0,u.useRouter)();let[o,c]=(0,l.useState)({name:"",password:"",role:"utilisateur"});(0,l.useEffect)(()=>{e((0,d.hU)()),e((0,d.Ny)())},[e]);let m=a=>{e((0,d.hG)(a))};return(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Gestion des utilisateurs"}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("span",{className:"block",children:["nom: ",null==s?void 0:s.name]}),(0,r.jsxs)("span",{className:"block",children:["role: ",null==s?void 0:s.role]})]}),(null==s?void 0:s.role)==="admin"&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:"text-[20px] font-bold mb-2",children:"Ajouter un nouveau utilisateur"}),(0,r.jsxs)("form",{onSubmit:a=>{a.preventDefault(),e((0,d.kg)(o)),c({name:"",password:"",role:"utilisateur"})},className:"mb-6 space-y-2",children:[(0,r.jsx)("input",{type:"text",placeholder:"Nom",value:o.name,onChange:e=>c({...o,name:e.target.value}),className:"border p-2 rounded w-full",required:!0}),(0,r.jsx)("input",{type:"password",placeholder:"Mot de passe",value:o.password,onChange:e=>c({...o,password:e.target.value}),className:"border p-2 rounded w-full",required:!0}),(0,r.jsxs)("select",{value:o.role,onChange:e=>c({...o,role:e.target.value}),className:"border p-2 rounded w-full",children:[(0,r.jsx)("option",{value:"caissier",children:"Caissier"}),(0,r.jsx)("option",{value:"impression",children:"Impression"}),(0,r.jsx)("option",{value:"admin",children:"Admin"})]}),(0,r.jsx)("button",{type:"submit",className:"bg-blue-500 text-white p-2 rounded w-full",children:"Cr\xe9er un utilisateur"})]}),(0,r.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-200",children:[(0,r.jsx)("th",{className:"border p-2",children:"Nom"}),(0,r.jsx)("th",{className:"border p-2",children:"R\xf4le"}),(0,r.jsx)("th",{className:"border p-2",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:a.map(e=>(0,r.jsxs)("tr",{className:"text-center",children:[(0,r.jsx)("td",{className:"border p-2",children:e.name}),(0,r.jsx)("td",{className:"border p-2",children:e.role}),(0,r.jsx)("td",{className:"border p-2",children:(0,r.jsx)("button",{onClick:()=>m(e.id),className:"bg-red-500 text-white px-3 py-1 rounded",children:"Supprimer"})})]},e.id))})]})]}),(0,r.jsx)("div",{children:(null==s?void 0:s.role)!=""?(0,r.jsxs)(n(),{href:"/connexion",onClick:()=>e((0,d.ri)()),className:"flex text-red-500 mt-4",children:[(0,r.jsx)(i,{}),(0,r.jsx)("span",{children:"Deconnexion"})]}):(0,r.jsxs)(n(),{href:"/connexion",className:"flex text-red-500 mt-4",children:[(0,r.jsx)(i,{}),(0,r.jsx)("span",{children:"Connexion"})]})})]})}},81654:(e,a,s)=>{"use strict";s.d(a,{Ay:()=>b,Lx:()=>d,Ny:()=>p,hG:()=>c,hU:()=>o,kg:()=>i,ri:()=>h});var r=s(48943),l=s(75033),t=s(27058);let d=(0,r.zD)("auth/loginUser",async e=>{let{name:a,password:s}=e,r=(0,t.rJ)(l.db,"users"),d=(0,t.P)(r,(0,t._M)("name","==",a),(0,t._M)("password","==",s)),i=await (0,t.GG)(d);if(!i.empty){let e=i.docs[0].id,a=(0,t.H9)(l.db,"users",e),s=await (0,t.x7)(a),r=s.data();if(r)return localStorage.setItem("id",s.id),localStorage.setItem("name",r.name),localStorage.setItem("role",r.role),{name:r.name,id:s.id,role:r.role}}throw Error("Identifiants incorrects")}),i=(0,r.zD)("auth/createUser",async e=>{let a=(0,t.rJ)(l.db,"users"),s=await (0,t.gS)(a,e);return{...e,id:s.id}}),o=(0,r.zD)("auth/fetchUsers",async()=>{let e=(0,t.rJ)(l.db,"users");return(await (0,t.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}),n=(0,r.zD)("auth/fetchUserById",async e=>{let a=(0,t.H9)(l.db,"users",e),s=await (0,t.x7)(a);if(s.exists())return{id:s.id,...s.data()};throw Error("Utilisateur non trouv\xe9")}),u=(0,r.zD)("auth/updateUser",async e=>{if(!e.id)throw Error("User ID is required");let a=(0,t.H9)(l.db,"users",e.id),{id:s,...r}=e;return await (0,t.mZ)(a,r),e}),c=(0,r.zD)("auth/deleteUser",async e=>{let a=(0,t.H9)(l.db,"users",e);return await (0,t.kd)(a),e}),m=(0,r.Z0)({name:"auth",initialState:{user:null,users:[]},reducers:{logout:e=>{e.user=null,localStorage.removeItem("id"),localStorage.removeItem("name"),localStorage.removeItem("role")},currentUser:e=>{e.user={id:localStorage.getItem("id")||"",name:localStorage.getItem("name")||"",role:localStorage.getItem("role")||""}},checkUser:e=>{let a=localStorage.getItem("id"),s=localStorage.getItem("name"),r=localStorage.getItem("role");a&&s&&r?e.user={id:a,name:s,role:r}:e.user=null}},extraReducers:e=>{e.addCase(d.fulfilled,(e,a)=>{e.user=a.payload}).addCase(o.fulfilled,(e,a)=>{e.users=a.payload}).addCase(n.fulfilled,(e,a)=>{e.users.find(e=>e.id===a.payload.id)||e.users.push(a.payload)}).addCase(i.fulfilled,(e,a)=>{e.users.push(a.payload)}).addCase(u.fulfilled,(e,a)=>{let s=e.users.findIndex(e=>e.id===a.payload.id);-1!==s&&(e.users[s]=a.payload)}).addCase(c.fulfilled,(e,a)=>{e.users=e.users.filter(e=>e.id!==a.payload)})}}),{logout:h,currentUser:p,checkUser:x}=m.actions,b=m.reducer},75033:(e,a,s)=>{"use strict";s.d(a,{db:()=>d});var r=s(49904),l=s(27058);let t=(0,r.Wp)({apiKey:"AIzaSyASZSWBGwPJYuQDRi1GObaNtrccuaBfu70",authDomain:"bgmultiservices-781c8.firebaseapp.com",projectId:"bgmultiservices-781c8",messagingSenderId:"749311417727",appId:"1:749311417727:web:3ea8698ba8ac3ac7ac8e4a"}),d=(0,l.aU)(t)}},e=>{var a=a=>e(e.s=a);e.O(0,[992,876,125,441,517,358],()=>a(97409)),_N_E=e.O()}]);