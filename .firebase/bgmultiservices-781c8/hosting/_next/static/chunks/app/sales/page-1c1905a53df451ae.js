(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[117],{3742:(e,a,t)=>{Promise.resolve().then(t.bind(t,29887))},29887:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>f});var l=t(95155),r=t(12115),d=t(29009),s=t(83391),o=t(94321),n=t(81654);let c=()=>{let[e,a]=(0,r.useState)(""),[t,c]=(0,r.useState)([]),i=(0,s.wA)(),u=(0,s.d4)(e=>e.product.products),p=(0,s.d4)(e=>e.auth.user);(0,r.useEffect)(()=>{i((0,o.j0)()),i((0,n.Ny)())},[i]);let g=async()=>{let l=t.reduce((e,a)=>e+Number(a.quantite)*Number(a.prix),0),r={date:new Date(e).toISOString(),articles:t,user:null==p?void 0:p.name,total:l};i((0,d.Vf)(r)),t.forEach(e=>{let a=null==u?void 0:u.find(a=>a.nom===e.nom);if(a&&a.id){let t=a.stock-e.quantite;i((0,o.vc)({id:a.id,newStock:t}))}}),a(""),c([])};return(0,l.jsxs)("div",{className:"md:px-[10%] px-4",children:[(0,l.jsx)("h2",{className:"w-full bg-blue-400 p-4 rounded-t-lg text-white",children:"Ajouter une vente"}),(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)("label",{htmlFor:"datejour",children:"Date du jour"}),(0,l.jsx)("input",{type:"date",id:"datejour",className:"block border-[1px] border-gray-300 w-full rounded-lg h-[35px]",value:e,onChange:e=>a(e.target.value)})]}),(0,l.jsx)("button",{onClick:()=>{c([...t,{nom:"",quantite:1,prix:0}])},className:"px-[10px] py-[3px] rounded-lg bg-gray-600 my-2 text-gray-100",children:"Ajouter un article"}),t.map((e,a)=>(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsxs)("select",{className:"border-[1px] border-gray-300 rounded-lg pl-2 mr-2 mb-2",value:e.nom,onChange:e=>{let l=null==u?void 0:u.find(a=>a.nom===e.target.value),r=[...t];r[a].nom=e.target.value,r[a].prix=l?l.prix:0,c(r)},children:[(0,l.jsx)("option",{value:"",children:"S\xe9lectionner un produit"}),null==u?void 0:u.map(e=>(0,l.jsx)("option",{value:e.nom,children:e.nom},e.id))]}),(0,l.jsx)("input",{type:"number",className:"border-[1px] border-gray-300 rounded-lg pl-2 mr-2 mb-2",placeholder:"Quantit\xe9",value:e.quantite,onChange:e=>{let l=[...t];l[a].quantite=Number(e.target.value),c(l)}}),(0,l.jsx)("input",{type:"number",className:"border-[1px] border-gray-300 rounded-lg pl-2 mr-2",placeholder:"Prix unitaire",value:e.prix,readOnly:!0}),(0,l.jsxs)("p",{children:["Total: ",Number(e.quantite)*Number(e.prix)," â‚¬"]})]},a)),(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsx)("button",{onClick:g,className:"px-[10px] py-[3px] rounded-lg bg-blue-400 my-2 text-gray-100",children:"Ajouter"})})]})};var i=t(11089),u=t(82715),p=t(10142),g=t(92340),y=t.n(g),m=t(14732);let h=e=>{let a=new p.default;a.setFontSize(18),a.text("Facture",20,20),a.setFontSize(12),a.text("Date: ".concat((0,m.l)(e.date)),20,30);let t=e.articles.map((e,a)=>[a+1,e.nom,e.quantite,"".concat(e.prix," FC")]);y()(a,{head:[["#","Nom du Produit","Quantit\xe9","Prix Total"]],body:t,startY:40});let l=t.length;a.text("Total: ".concat(e.total," FC"),20,40+10*l+10),a.save("Facture_".concat(e.id,".pdf"))};function f(){let e=(0,s.wA)(),a=(0,s.d4)(e=>e.sale.sales);(0,r.useEffect)(()=>{e((0,d.j3)())},[e]);let t=a=>e((0,d.dS)(a));return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"text-2xl py-4",children:"Ventes"}),(0,l.jsx)(c,{}),(0,l.jsx)("div",{className:"text-xl py-4",children:"Les ventes enregistr\xe9es"}),(0,l.jsxs)("table",{className:"w-full text-center border-collapse border border-gray-300",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"border-b-[1px] border-gray-300",children:[(0,l.jsx)("th",{children:"Date"}),(0,l.jsx)("th",{children:"Articles"}),(0,l.jsx)("th",{children:"Prix total"}),(0,l.jsx)("th",{children:"Encod\xe9 par"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:a&&a.length>0?a.map(e=>(0,l.jsxs)("tr",{className:"border-b-[1px] border-gray-300",children:[(0,l.jsx)("td",{children:(0,m.l)(e.date)}),(0,l.jsx)("td",{children:e.articles.map((e,a)=>(0,l.jsxs)("span",{children:["Nom: ",e.nom,", Qt\xe9: ",e.quantite,", PrixTot: ",e.prix," FC"," "]},a))}),(0,l.jsxs)("td",{children:[e.total," FC"]}),(0,l.jsx)("td",{children:e.user}),(0,l.jsxs)("td",{className:"flex justify-center",children:[(0,l.jsx)(i.A,{size:20,className:"cursor-pointer",onClick:()=>h(e)}),(0,l.jsx)("span",{className:"w-[10px]"}),(0,l.jsx)(u.A,{size:20,onClick:()=>t(e.id),className:"text-red-500 cursor-pointer"})]})]},e.id)):(0,l.jsx)("tr",{className:"border-b-[1px] border-gray-300",children:(0,l.jsx)("td",{colSpan:4,children:"Pas de ventes enregistr\xe9es"})})})]})]})}},81654:(e,a,t)=>{"use strict";t.d(a,{Ay:()=>h,Lx:()=>s,Ny:()=>y,hG:()=>u,hU:()=>n,kg:()=>o,ri:()=>g});var l=t(48943),r=t(75033),d=t(27058);let s=(0,l.zD)("auth/loginUser",async e=>{let{name:a,password:t}=e,l=(0,d.rJ)(r.db,"users"),s=(0,d.P)(l,(0,d._M)("name","==",a),(0,d._M)("password","==",t)),o=await (0,d.GG)(s);if(!o.empty){let e=o.docs[0].id,a=(0,d.H9)(r.db,"users",e),t=await (0,d.x7)(a),l=t.data();if(l)return localStorage.setItem("id",t.id),localStorage.setItem("name",l.name),localStorage.setItem("role",l.role),{name:l.name,id:t.id,role:l.role}}throw Error("Identifiants incorrects")}),o=(0,l.zD)("auth/createUser",async e=>{let a=(0,d.rJ)(r.db,"users"),t=await (0,d.gS)(a,e);return{...e,id:t.id}}),n=(0,l.zD)("auth/fetchUsers",async()=>{let e=(0,d.rJ)(r.db,"users");return(await (0,d.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}),c=(0,l.zD)("auth/fetchUserById",async e=>{let a=(0,d.H9)(r.db,"users",e),t=await (0,d.x7)(a);if(t.exists())return{id:t.id,...t.data()};throw Error("Utilisateur non trouv\xe9")}),i=(0,l.zD)("auth/updateUser",async e=>{if(!e.id)throw Error("User ID is required");let a=(0,d.H9)(r.db,"users",e.id),{id:t,...l}=e;return await (0,d.mZ)(a,l),e}),u=(0,l.zD)("auth/deleteUser",async e=>{let a=(0,d.H9)(r.db,"users",e);return await (0,d.kd)(a),e}),p=(0,l.Z0)({name:"auth",initialState:{user:null,users:[]},reducers:{logout:e=>{e.user=null,localStorage.removeItem("id"),localStorage.removeItem("name"),localStorage.removeItem("role")},currentUser:e=>{e.user={id:localStorage.getItem("id")||"",name:localStorage.getItem("name")||"",role:localStorage.getItem("role")||""}},checkUser:e=>{let a=localStorage.getItem("id"),t=localStorage.getItem("name"),l=localStorage.getItem("role");a&&t&&l?e.user={id:a,name:t,role:l}:e.user=null}},extraReducers:e=>{e.addCase(s.fulfilled,(e,a)=>{e.user=a.payload}).addCase(n.fulfilled,(e,a)=>{e.users=a.payload}).addCase(c.fulfilled,(e,a)=>{e.users.find(e=>e.id===a.payload.id)||e.users.push(a.payload)}).addCase(o.fulfilled,(e,a)=>{e.users.push(a.payload)}).addCase(i.fulfilled,(e,a)=>{let t=e.users.findIndex(e=>e.id===a.payload.id);-1!==t&&(e.users[t]=a.payload)}).addCase(u.fulfilled,(e,a)=>{e.users=e.users.filter(e=>e.id!==a.payload)})}}),{logout:g,currentUser:y,checkUser:m}=p.actions,h=p.reducer},94321:(e,a,t)=>{"use strict";t.d(a,{Ay:()=>u,Bj:()=>s,DD:()=>c,Qu:()=>i,j0:()=>o,vc:()=>n});var l=t(48943),r=t(27058),d=t(75033);let s=(0,l.zD)("product/addProduct",async e=>({id:(await (0,r.gS)((0,r.rJ)(d.db,"products"),e)).id,...e})),o=(0,l.zD)("product/fetchProducts",async()=>(await (0,r.GG)((0,r.rJ)(d.db,"products"))).docs.map(e=>({id:e.id,...e.data()}))),n=(0,l.zD)("product/updateProduct",async e=>{let{id:a,newStock:t}=e,l=(0,r.H9)(d.db,"products",a);return await (0,r.mZ)(l,{stock:t}),{id:a,newStock:t}}),c=(0,l.zD)("product/deleteProduct",async e=>(await (0,r.kd)((0,r.H9)(d.db,"products",e)),e)),i=(0,l.zD)("product/totalStock",async()=>{let e=(0,r.rJ)(d.db,"products"),a=await (0,r.GG)(e),t=0;return a.docs.forEach(e=>{t+=e.data().stock||0}),t}),u=(0,l.Z0)({name:"product",initialState:{loading:!1,products:null,error:"",totalProductsInStock:0},reducers:{},extraReducers:e=>{e.addCase(o.pending,e=>{e.loading=!0}),e.addCase(o.fulfilled,(e,a)=>{e.loading=!1,e.products=a.payload}),e.addCase(o.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}),e.addCase(s.fulfilled,(e,a)=>{e.products=e.products?[...e.products,a.payload]:[a.payload]}),e.addCase(n.fulfilled,(e,a)=>{e.products&&(e.products=e.products.map(e=>e.id===a.payload.id?{...e,stock:a.payload.newStock}:e))}),e.addCase(c.fulfilled,(e,a)=>{e.products&&(e.products=e.products.filter(e=>e.id!==a.payload))}),e.addCase(i.fulfilled,(e,a)=>{e.totalProductsInStock=a.payload})}}).reducer},29009:(e,a,t)=>{"use strict";t.d(a,{Ay:()=>S,FQ:()=>i,Op:()=>p,RA:()=>g,Vf:()=>s,Xg:()=>b,aK:()=>u,cF:()=>f,cP:()=>x,dS:()=>c,h8:()=>m,j3:()=>o,ke:()=>y});var l=t(48943),r=t(27058),d=t(75033);let s=(0,l.zD)("sale/addSale",async e=>{try{let a=await (0,r.gS)((0,r.rJ)(d.db,"sales"),e);console.log("Vente ajout\xe9 avec ID :",a.id)}catch(e){console.error("Erreur lors de l'ajout :",e)}}),o=(0,l.zD)("sale/fetchSales",async()=>{try{let e=(await (0,r.GG)((0,r.rJ)(d.db,"sales"))).docs.map(e=>({id:e.id,...e.data()}));return console.log("ventes r\xe9cup\xe9r\xe9s :",e),e}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration :",e)}}),n=(0,l.zD)("sale/updateSale",async(e,a)=>{try{let t=(0,r.H9)(d.db,"sales",e);await (0,r.mZ)(t,a),console.log("Vente mis \xe0 jour !")}catch(e){console.error("Erreur lors de la mise \xe0 jour :",e)}}),c=(0,l.zD)("sale/deleteSale",async e=>{try{await (0,r.kd)((0,r.H9)(d.db,"sales",e)),console.log("Vente supprim\xe9 !")}catch(e){console.error("Erreur lors de la suppression :",e)}}),i=(0,l.zD)("sale/fetchSalesCountToday",async()=>{let e=new Date,a=e.getUTCFullYear(),t=String(e.getUTCMonth()+1).padStart(2,"0"),l=String(e.getUTCDate()).padStart(2,"0"),s="".concat(a,"-").concat(t,"-").concat(l,"T00:00:00.000Z"),o=(0,r.rJ)(d.db,"sales"),n=(0,r.P)(o,(0,r._M)("date","==",s));return(await (0,r.GG)(n)).docs.length}),u=(0,l.zD)("sale/fetchTotalSalesCount",async()=>{let e=(0,r.rJ)(d.db,"sales");return(await (0,r.GG)(e)).docs.length}),p=(0,l.zD)("sale/amountToday",async()=>{let e=new Date,a=e.getUTCFullYear(),t=String(e.getUTCMonth()+1).padStart(2,"0"),l=String(e.getUTCDate()).padStart(2,"0"),s="".concat(a,"-").concat(t,"-").concat(l,"T00:00:00.000Z"),o=(0,r.rJ)(d.db,"sales"),n=(0,r.P)(o,(0,r._M)("date","==",s)),c=await (0,r.GG)(n),i=0;return c.docs.forEach(e=>{let a=e.data();i+=a.total}),i}),g=(0,l.zD)("sale/totalAmount",async()=>{let e=(0,r.rJ)(d.db,"sales"),a=await (0,r.GG)(e),t=0;return a.docs.forEach(e=>{let a=e.data();t+=a.total}),t}),y=(0,l.zD)("sale/last10",async()=>{let e=(0,r.rJ)(d.db,"sales"),a=(0,r.P)(e,(0,r.My)("date","desc"),(0,r.AB)(10));return(await (0,r.GG)(a)).docs.map(e=>({id:e.id,...e.data()}))}),m=(0,l.zD)("sale/last7Days",async()=>{let e=new Date,a=new Date;a.setDate(e.getDate()-7),a.setHours(0,0,0,0);let t="".concat(a.getUTCFullYear(),"-").concat(String(a.getUTCMonth()+1).padStart(2,"0"),"-").concat(String(a.getUTCDate()).padStart(2,"0"),"T00:00:00.000Z"),l=(0,r.rJ)(d.db,"sales"),s=(0,r.P)(l,(0,r._M)("date",">=",t)),o=await (0,r.GG)(s),n={};for(let a=6;a>=0;a--){let t=new Date;t.setDate(e.getDate()-a),n["".concat(t.getUTCFullYear(),"-").concat(String(t.getUTCMonth()+1).padStart(2,"0"),"-").concat(String(t.getUTCDate()).padStart(2,"0"),"T00:00:00.000Z").split("T")[0]]=0}return o.docs.forEach(e=>{let a=e.data(),t=new Date(a.date),l="".concat(t.getUTCFullYear(),"-").concat(String(t.getUTCMonth()+1).padStart(2,"0"),"-").concat(String(t.getUTCDate()).padStart(2,"0"),"T00:00:00.000Z").split("T")[0];n.hasOwnProperty(l)&&(n[l]+=a.total)}),n}),h=(0,l.zD)("sale/byProduct",async()=>{let e=(0,r.rJ)(d.db,"sales"),a=await (0,r.GG)(e),t={};return a.docs.forEach(e=>{e.data().articles.forEach(e=>{t[e.nom]||(t[e.nom]=0),t[e.nom]+=e.total})}),t}),f=(0,l.zD)("sale/fetchSumDaySales",async e=>{let a=(0,r.rJ)(d.db,"sales"),t=(0,r.P)(a,(0,r._M)("date","==",e)),l=await (0,r.GG)(t),s=0;return l.docs.forEach(e=>{let a=e.data();s+=a.total}),s}),x=(0,l.zD)("sale/fetchNumberDaySales",async e=>{let a=(0,r.rJ)(d.db,"sales"),t=(0,r.P)(a,(0,r._M)("date","==",e));return(await (0,r.GG)(t)).docs.length}),b=(0,l.zD)("sale/fetchAllDaysSales",async e=>{let a=(0,r.rJ)(d.db,"sales"),t=(0,r.P)(a,(0,r._M)("date","==",e));return(await (0,r.GG)(t)).docs.map(e=>({id:e.id,...e.data()}))}),S=(0,l.Z0)({name:"sale",initialState:{loading:!1,salesLast7Days:[],sales:null,error:"",salesByProduct:[],salesCountToday:0,totalSalesCount:0,salesAmountToday:0,totalSalesAmount:0,salesAmountTDay:0,nbrSalesDay:0,allDaysSales:[]},reducers:{},extraReducers:e=>{e.addCase(s.pending,e=>{e.loading=!0}).addCase(s.fulfilled,e=>{e.loading=!1}).addCase(s.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(o.pending,e=>{e.loading=!0}).addCase(o.fulfilled,(e,a)=>{e.loading=!1,e.sales=a.payload}).addCase(o.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(n.pending,e=>{e.loading=!0}).addCase(n.fulfilled,e=>{e.loading=!1}).addCase(n.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(c.pending,e=>{e.loading=!0}).addCase(c.fulfilled,e=>{e.loading=!1}).addCase(c.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(i.fulfilled,(e,a)=>{e.salesCountToday=a.payload}).addCase(u.fulfilled,(e,a)=>{e.totalSalesCount=a.payload}).addCase(p.fulfilled,(e,a)=>{e.salesAmountToday=a.payload}).addCase(g.fulfilled,(e,a)=>{e.totalSalesAmount=a.payload}).addCase(y.fulfilled,(e,a)=>{e.sales=a.payload}).addCase(m.fulfilled,(e,a)=>{e.salesLast7Days=a.payload}).addCase(h.fulfilled,(e,a)=>{e.salesByProduct=a.payload}).addCase(f.fulfilled,(e,a)=>{e.salesAmountTDay=a.payload}).addCase(x.fulfilled,(e,a)=>{e.nbrSalesDay=a.payload}).addCase(b.fulfilled,(e,a)=>{e.allDaysSales=a.payload})}}).reducer},14732:(e,a,t)=>{"use strict";t.d(a,{l:()=>l});let l=e=>{let a=new Date(e),t=String(a.getUTCDate()).padStart(2,"0"),l=String(a.getUTCMonth()+1).padStart(2,"0"),r=a.getUTCFullYear();return"".concat(t," ").concat(l," ").concat(r)}},75033:(e,a,t)=>{"use strict";t.d(a,{db:()=>s});var l=t(49904),r=t(27058);let d=(0,l.Wp)({apiKey:"AIzaSyASZSWBGwPJYuQDRi1GObaNtrccuaBfu70",authDomain:"bgmultiservices-781c8.firebaseapp.com",projectId:"bgmultiservices-781c8",messagingSenderId:"749311417727",appId:"1:749311417727:web:3ea8698ba8ac3ac7ac8e4a"}),s=(0,r.aU)(d)}},e=>{var a=a=>e(e.s=a);e.O(0,[992,930,876,272,441,517,358],()=>a(3742)),_N_E=e.O()}]);