(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[117],{3742:(e,a,t)=>{Promise.resolve().then(t.bind(t,29887))},29887:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>x});var d=t(95155),r=t(12115),l=t(29009),s=t(83391),o=t(94321);let n=()=>{let[e,a]=(0,r.useState)(""),[t,n]=(0,r.useState)([]),c=(0,s.wA)(),i=(0,s.d4)(e=>e.product.products);(0,r.useEffect)(()=>{c((0,o.j0)())},[c]);let u=async()=>{let d=t.reduce((e,a)=>e+Number(a.quantite)*Number(a.prix),0),r={date:new Date(e).toISOString(),articles:t,total:d};c((0,l.Vf)(r)),t.forEach(e=>{let a=null==i?void 0:i.find(a=>a.nom===e.nom);if(a&&a.id){let t=a.stock-e.quantite;c((0,o.vc)({id:a.id,newStock:t}))}}),a(""),n([])};return(0,d.jsxs)("div",{className:"md:px-[10%] px-4",children:[(0,d.jsx)("h2",{className:"w-full bg-blue-400 p-4 rounded-t-lg text-white",children:"Ajouter une vente"}),(0,d.jsxs)("div",{className:"mt-2",children:[(0,d.jsx)("label",{htmlFor:"datejour",children:"Date du jour"}),(0,d.jsx)("input",{type:"date",id:"datejour",className:"block border-[1px] border-gray-300 w-full rounded-lg h-[35px]",value:e,onChange:e=>a(e.target.value)})]}),(0,d.jsx)("button",{onClick:()=>{n([...t,{nom:"",quantite:1,prix:0}])},className:"px-[10px] py-[3px] rounded-lg bg-gray-600 my-2 text-gray-100",children:"Ajouter un article"}),t.map((e,a)=>(0,d.jsxs)("div",{className:"mt-2",children:[(0,d.jsxs)("select",{className:"border-[1px] border-gray-300 rounded-lg pl-2 mr-2 mb-2",value:e.nom,onChange:e=>{let d=null==i?void 0:i.find(a=>a.nom===e.target.value),r=[...t];r[a].nom=e.target.value,r[a].prix=d?d.prix:0,n(r)},children:[(0,d.jsx)("option",{value:"",children:"S\xe9lectionner un produit"}),null==i?void 0:i.map(e=>(0,d.jsx)("option",{value:e.nom,children:e.nom},e.id))]}),(0,d.jsx)("input",{type:"number",className:"border-[1px] border-gray-300 rounded-lg pl-2 mr-2 mb-2",placeholder:"Quantit\xe9",value:e.quantite,onChange:e=>{let d=[...t];d[a].quantite=Number(e.target.value),n(d)}}),(0,d.jsx)("input",{type:"number",className:"border-[1px] border-gray-300 rounded-lg pl-2 mr-2",placeholder:"Prix unitaire",value:e.prix,readOnly:!0}),(0,d.jsxs)("p",{children:["Total: ",Number(e.quantite)*Number(e.prix)," â‚¬"]})]},a)),(0,d.jsx)("div",{className:"flex justify-end",children:(0,d.jsx)("button",{onClick:u,className:"px-[10px] py-[3px] rounded-lg bg-blue-400 my-2 text-gray-100",children:"Ajouter"})})]})};var c=t(11089),i=t(82715),u=t(10142),p=t(92340),g=t.n(p),y=t(14732);let m=e=>{let a=new u.default;a.setFontSize(18),a.text("Facture",20,20),a.setFontSize(12),a.text("Date: ".concat((0,y.l)(e.date)),20,30);let t=e.articles.map((e,a)=>[a+1,e.nom,e.quantite,"".concat(e.prix," FC")]);g()(a,{head:[["#","Nom du Produit","Quantit\xe9","Prix Total"]],body:t,startY:40});let d=t.length;a.text("Total: ".concat(e.total," FC"),20,40+10*d+10),a.save("Facture_".concat(e.id,".pdf"))};function x(){let e=(0,s.wA)(),a=(0,s.d4)(e=>e.sale.sales);(0,r.useEffect)(()=>{e((0,l.j3)())},[e]);let t=a=>e((0,l.dS)(a));return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"text-2xl py-4",children:"Ventes"}),(0,d.jsx)(n,{}),(0,d.jsx)("div",{className:"text-xl py-4",children:"Les ventes enregistr\xe9es"}),(0,d.jsxs)("table",{className:"w-full text-center border-collapse border border-gray-300",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"border-b-[1px] border-gray-300",children:[(0,d.jsx)("th",{children:"Date"}),(0,d.jsx)("th",{children:"Articles"}),(0,d.jsx)("th",{children:"Prix total"}),(0,d.jsx)("th",{children:"Actions"})]})}),(0,d.jsx)("tbody",{children:a&&a.length>0?a.map(e=>(0,d.jsxs)("tr",{className:"border-b-[1px] border-gray-300",children:[(0,d.jsx)("td",{children:(0,y.l)(e.date)}),(0,d.jsx)("td",{children:e.articles.map((e,a)=>(0,d.jsxs)("span",{children:["Nom: ",e.nom,", Qt\xe9: ",e.quantite,", PrixTot: ",e.prix," FC"," "]},a))}),(0,d.jsxs)("td",{children:[e.total," FC"]}),(0,d.jsxs)("td",{className:"flex justify-center",children:[(0,d.jsx)(c.A,{size:20,className:"cursor-pointer",onClick:()=>m(e)}),(0,d.jsx)("span",{className:"w-[10px]"}),(0,d.jsx)(i.A,{size:20,onClick:()=>t(e.id),className:"text-red-500 cursor-pointer"})]})]},e.id)):(0,d.jsx)("tr",{className:"border-b-[1px] border-gray-300",children:(0,d.jsx)("td",{colSpan:4,children:"Pas de ventes enregistr\xe9es"})})})]})]})}},94321:(e,a,t)=>{"use strict";t.d(a,{Ay:()=>u,Bj:()=>s,DD:()=>c,Qu:()=>i,j0:()=>o,vc:()=>n});var d=t(48943),r=t(27058),l=t(75033);let s=(0,d.zD)("product/addProduct",async e=>({id:(await (0,r.gS)((0,r.rJ)(l.db,"products"),e)).id,...e})),o=(0,d.zD)("product/fetchProducts",async()=>(await (0,r.GG)((0,r.rJ)(l.db,"products"))).docs.map(e=>({id:e.id,...e.data()}))),n=(0,d.zD)("product/updateProduct",async e=>{let{id:a,newStock:t}=e,d=(0,r.H9)(l.db,"products",a);return await (0,r.mZ)(d,{stock:t}),{id:a,newStock:t}}),c=(0,d.zD)("product/deleteProduct",async e=>(await (0,r.kd)((0,r.H9)(l.db,"products",e)),e)),i=(0,d.zD)("product/totalStock",async()=>{let e=(0,r.rJ)(l.db,"products"),a=await (0,r.GG)(e),t=0;return a.docs.forEach(e=>{t+=e.data().stock||0}),t}),u=(0,d.Z0)({name:"product",initialState:{loading:!1,products:null,error:"",totalProductsInStock:0},reducers:{},extraReducers:e=>{e.addCase(o.pending,e=>{e.loading=!0}),e.addCase(o.fulfilled,(e,a)=>{e.loading=!1,e.products=a.payload}),e.addCase(o.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}),e.addCase(s.fulfilled,(e,a)=>{e.products=e.products?[...e.products,a.payload]:[a.payload]}),e.addCase(n.fulfilled,(e,a)=>{e.products&&(e.products=e.products.map(e=>e.id===a.payload.id?{...e,stock:a.payload.newStock}:e))}),e.addCase(c.fulfilled,(e,a)=>{e.products&&(e.products=e.products.filter(e=>e.id!==a.payload))}),e.addCase(i.fulfilled,(e,a)=>{e.totalProductsInStock=a.payload})}}).reducer},29009:(e,a,t)=>{"use strict";t.d(a,{Ay:()=>h,FQ:()=>i,Op:()=>p,RA:()=>g,Vf:()=>s,aK:()=>u,dS:()=>c,h8:()=>m,j3:()=>o,ke:()=>y});var d=t(48943),r=t(27058),l=t(75033);let s=(0,d.zD)("sale/addSale",async e=>{try{let a=await (0,r.gS)((0,r.rJ)(l.db,"sales"),e);console.log("Vente ajout\xe9 avec ID :",a.id)}catch(e){console.error("Erreur lors de l'ajout :",e)}}),o=(0,d.zD)("sale/fetchSales",async()=>{try{let e=(await (0,r.GG)((0,r.rJ)(l.db,"sales"))).docs.map(e=>({id:e.id,...e.data()}));return console.log("ventes r\xe9cup\xe9r\xe9s :",e),e}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration :",e)}}),n=(0,d.zD)("sale/updateSale",async(e,a)=>{try{let t=(0,r.H9)(l.db,"sales",e);await (0,r.mZ)(t,a),console.log("Vente mis \xe0 jour !")}catch(e){console.error("Erreur lors de la mise \xe0 jour :",e)}}),c=(0,d.zD)("sale/deleteSale",async e=>{try{await (0,r.kd)((0,r.H9)(l.db,"sales",e)),console.log("Vente supprim\xe9 !")}catch(e){console.error("Erreur lors de la suppression :",e)}}),i=(0,d.zD)("sale/fetchSalesCountToday",async()=>{let e=new Date,a=e.getUTCFullYear(),t=String(e.getUTCMonth()+1).padStart(2,"0"),d=String(e.getUTCDate()).padStart(2,"0"),s="".concat(a,"-").concat(t,"-").concat(d,"T00:00:00.000Z"),o=(0,r.rJ)(l.db,"sales"),n=(0,r.P)(o,(0,r._M)("date","==",s));return(await (0,r.GG)(n)).docs.length}),u=(0,d.zD)("sale/fetchTotalSalesCount",async()=>{let e=(0,r.rJ)(l.db,"sales");return(await (0,r.GG)(e)).docs.length}),p=(0,d.zD)("sale/amountToday",async()=>{let e=new Date,a=e.getUTCFullYear(),t=String(e.getUTCMonth()+1).padStart(2,"0"),d=String(e.getUTCDate()).padStart(2,"0"),s="".concat(a,"-").concat(t,"-").concat(d,"T00:00:00.000Z"),o=(0,r.rJ)(l.db,"sales"),n=(0,r.P)(o,(0,r._M)("date","==",s)),c=await (0,r.GG)(n),i=0;return c.docs.forEach(e=>{let a=e.data();i+=a.total}),i}),g=(0,d.zD)("sale/totalAmount",async()=>{let e=(0,r.rJ)(l.db,"sales"),a=await (0,r.GG)(e),t=0;return a.docs.forEach(e=>{let a=e.data();t+=a.total}),t}),y=(0,d.zD)("sale/last10",async()=>{let e=(0,r.rJ)(l.db,"sales"),a=(0,r.P)(e,(0,r.My)("date","desc"),(0,r.AB)(10));return(await (0,r.GG)(a)).docs.map(e=>({id:e.id,...e.data()}))}),m=(0,d.zD)("sale/last7Days",async()=>{let e=new Date,a=new Date;a.setDate(e.getDate()-7),a.setHours(0,0,0,0);let t="".concat(a.getUTCFullYear(),"-").concat(String(a.getUTCMonth()+1).padStart(2,"0"),"-").concat(String(a.getUTCDate()).padStart(2,"0"),"T00:00:00.000Z"),d=(0,r.rJ)(l.db,"sales"),s=(0,r.P)(d,(0,r._M)("date",">=",t)),o=await (0,r.GG)(s),n={};for(let a=6;a>=0;a--){let t=new Date;t.setDate(e.getDate()-a),n["".concat(t.getUTCFullYear(),"-").concat(String(t.getUTCMonth()+1).padStart(2,"0"),"-").concat(String(t.getUTCDate()).padStart(2,"0"),"T00:00:00.000Z").split("T")[0]]=0}return o.docs.forEach(e=>{let a=e.data(),t=new Date(a.date),d="".concat(t.getUTCFullYear(),"-").concat(String(t.getUTCMonth()+1).padStart(2,"0"),"-").concat(String(t.getUTCDate()).padStart(2,"0"),"T00:00:00.000Z").split("T")[0];n.hasOwnProperty(d)&&(n[d]+=a.total)}),n}),x=(0,d.zD)("sale/byProduct",async()=>{let e=(0,r.rJ)(l.db,"sales"),a=await (0,r.GG)(e),t={};return a.docs.forEach(e=>{e.data().articles.forEach(e=>{t[e.nom]||(t[e.nom]=0),t[e.nom]+=e.total})}),t}),h=(0,d.Z0)({name:"sale",initialState:{loading:!1,salesLast7Days:[],sales:null,error:"",salesByProduct:[],salesCountToday:0,totalSalesCount:0,salesAmountToday:0,totalSalesAmount:0},reducers:{},extraReducers:e=>{e.addCase(s.pending,e=>{e.loading=!0}).addCase(s.fulfilled,e=>{e.loading=!1}).addCase(s.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(o.pending,e=>{e.loading=!0}).addCase(o.fulfilled,(e,a)=>{e.loading=!1,e.sales=a.payload}).addCase(o.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(n.pending,e=>{e.loading=!0}).addCase(n.fulfilled,e=>{e.loading=!1}).addCase(n.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(c.pending,e=>{e.loading=!0}).addCase(c.fulfilled,e=>{e.loading=!1}).addCase(c.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(i.fulfilled,(e,a)=>{e.salesCountToday=a.payload}).addCase(u.fulfilled,(e,a)=>{e.totalSalesCount=a.payload}).addCase(p.fulfilled,(e,a)=>{e.salesAmountToday=a.payload}).addCase(g.fulfilled,(e,a)=>{e.totalSalesAmount=a.payload}).addCase(y.fulfilled,(e,a)=>{e.sales=a.payload}).addCase(m.fulfilled,(e,a)=>{e.salesLast7Days=a.payload}).addCase(x.fulfilled,(e,a)=>{e.salesByProduct=a.payload})}}).reducer},14732:(e,a,t)=>{"use strict";t.d(a,{l:()=>d});let d=e=>{let a=new Date(e),t=String(a.getUTCDate()).padStart(2,"0"),d=String(a.getUTCMonth()+1).padStart(2,"0"),r=a.getUTCFullYear();return"".concat(t," ").concat(d," ").concat(r)}},75033:(e,a,t)=>{"use strict";t.d(a,{db:()=>s});var d=t(49904),r=t(27058);let l=(0,d.Wp)({apiKey:"AIzaSyASZSWBGwPJYuQDRi1GObaNtrccuaBfu70",authDomain:"bgmultiservices-781c8.firebaseapp.com",projectId:"bgmultiservices-781c8",messagingSenderId:"749311417727",appId:"1:749311417727:web:3ea8698ba8ac3ac7ac8e4a"}),s=(0,r.aU)(l)}},e=>{var a=a=>e(e.s=a);e.O(0,[992,930,876,272,441,517,358],()=>a(3742)),_N_E=e.O()}]);